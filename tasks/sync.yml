version: '3'

vars:
  LOGSEQ_SYNC_CMD:
    sh: |
      if [ -n "$TERMUX_VERSION" ] || [ -d "/data/data/com.termux" ]; then
        echo "RCLONE_BIN=/data/data/com.termux/files/usr/bin/rclone-secure bash <(sed '1s|^#!/usr/bin/env bash\$|#!/data/data/com.termux/files/usr/bin/bash|' ./scripts/logseq-sync.sh)"
      else
        echo "bash ./scripts/logseq-sync.sh"
      fi
  LOGSEQ_SCHEDULE_CMD:
    sh: |
      if [ -n "$TERMUX_VERSION" ] || [ -d "/data/data/com.termux" ]; then
        echo "bash <(sed '1s|^#!/usr/bin/env bash\$|#!/data/data/com.termux/files/usr/bin/bash|' ./scripts/logseq-sync-schedule.sh)"
      else
        echo "bash ./scripts/logseq-sync-schedule.sh"
      fi

tasks:
  default:
    desc: Show logseq sync help
    cmds:
      - "{{.LOGSEQ_SYNC_CMD}} --help"

  logseq:
    desc: Sync logseq folder with cloud (bidirectional)
    cmds:
      - "{{.LOGSEQ_SYNC_CMD}} {{.CLI_ARGS | default \"bidirectional\"}}"

  logseq:setup:
    desc: Setup automatic logseq sync scheduling
    cmds:
      - "{{.LOGSEQ_SCHEDULE_CMD}} setup"

  logseq:status:
    desc: Show logseq sync scheduling status
    cmds:
      - "{{.LOGSEQ_SCHEDULE_CMD}} status"

  logseq:remove:
    desc: Remove logseq sync scheduling
    cmds:
      - "{{.LOGSEQ_SCHEDULE_CMD}} remove"
