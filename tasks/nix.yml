version: '3'

tasks:
  default:
    cmds:
      - task --list-all
    silent: true
  clean:
    desc: Clean up Nix store
    silent: true
    cmds:
      - |
        nix store gc
  upgrade:
    desc: Update Nix flake inputs and rebuild
    cmds:
      - |
        echo "Updating flake inputs..."
        nix flake update
        echo "Rebuilding configuration..."
        nix run home-manager/master -- switch --flake .#{{.USER}}
  get_github_hash:*:*:*:
    desk:
    silent: true
    vars:
      OWNER: "{{index .MATCH 0}}"
      REPO: "{{index .MATCH 1}}"
      REVISION: "{{index .MATCH 2}}"
    cmds:
      - |
        nix-prefetch-url --unpack https://github.com/{{.OWNER}}/{{.REPO}}/archive/{{.REVISION}}.tar.gz
